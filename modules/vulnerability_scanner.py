import requests
import os
from dotenv import load_dotenv

load_dotenv()

class APIVulnerabilityScanner:
    def __init__(self):
        self.api_url = "https://services.nvd.nist.gov/rest/json/cves/1.0"
        self.api_key = os.getenv("NVD_API_KEY")

    def get_vulnerabilities(self, keyword=""):
        params = {"keyword": keyword, "resultsPerPage": 5}
        headers = {"Authorization": f"Bearer {self.api_key}"}
        response = requests.get(self.api_url, headers=headers, params=params)

        if response.status_code == 200:
            data = response.json()
            vulnerabilities = [
                f"{item['cve']['CVE_data_meta']['ID']} - {item['cve']['description']['description_data'][0]['value']}"
                for item in data.get("result", {}).get("CVE_Items", [])
            ]
            return vulnerabilities
        return ["No vulnerabilities found."]
